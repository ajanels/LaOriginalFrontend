<!-- ====== VISTA DETALLE (drawer a la derecha) ====== -->
<ng-container *ngIf="isView; else createEditTpl">
  <div class="modal-backdrop" (click)="cancel()"></div>
  <div class="container drawer" (click)="cancel()">
    <div class="panel" (click)="$event.stopPropagation()">
      <div class="panel-head">
        <h2>Detalle de usuario</h2>
        <button class="icon" (click)="cancel()" aria-label="Cerrar">
          <span class="material-icons">close</span>
        </button>
      </div>

      <div class="view">
        <div class="avatar">
          <img *ngIf="photoPreview; else ph" [src]="photoPreview" alt="Foto" />
          <ng-template #ph><div class="placeholder">{{ usuario?.primerNombre?.charAt(0) }}</div></ng-template>
        </div>

        <dl>
          <div><dt>Nombre</dt><dd>{{usuario?.primerNombre}} {{usuario?.segundoNombre}}</dd></div>
          <div><dt>Apellido</dt><dd>{{usuario?.primerApellido}} {{usuario?.segundoApellido}}</dd></div>
          <div><dt>Usuario</dt><dd class="mono">{{usuario?.username}}</dd></div>
          <div><dt>Rol</dt><dd>{{ $any(usuario)?.rol?.nombre || '—' }}</dd></div>
          <div><dt>Teléfono</dt><dd>{{usuario?.celular}}</dd></div>
          <div><dt>Estado</dt><dd>{{usuario?.estado}}</dd></div>
          <div><dt>NIT</dt><dd>{{usuario?.nit}}</dd></div>
          <div><dt>CUI</dt><dd>{{usuario?.cui}}</dd></div>
          <div><dt>Email</dt><dd>{{usuario?.email}}</dd></div>
          <div><dt>Dirección</dt><dd>{{usuario?.direccion}}</dd></div>
        </dl>

        <div class="panel-actions">
          <button class="ghost" (click)="cancel()">Cerrar</button>
        </div>
      </div>
    </div>
  </div>
</ng-container>

<!-- ====== CREAR / EDITAR (modal centrado 4 columnas) ====== -->
<ng-template #createEditTpl>
  <div class="modal-backdrop" (click)="cancel()"></div>

  <section class="modal" role="dialog" aria-modal="true" aria-labelledby="um-title" (click)="cancel()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <header class="modal-head">
        <div class="modal-title-wrap">
          <span class="modal-dot"></span>
          <h2 id="um-title">{{ isCreate ? 'Nuevo usuario' : 'Editar usuario' }}</h2>
        </div>
        <button class="icon close" type="button" (click)="cancel()" aria-label="Cerrar">
          <span class="material-icons">close</span>
        </button>
      </header>

      <form class="form four-col" [formGroup]="form" (ngSubmit)="save()">
        <!-- 1 -->
        <label>Primer nombre* <input formControlName="primerNombre" /></label>
        <label>Segundo nombre <input formControlName="segundoNombre" /></label>
        <label>Primer apellido* <input formControlName="primerApellido" /></label>
        <label>Segundo apellido <input formControlName="segundoApellido" /></label>

        <!-- 2 -->
        <label>NIT* <input formControlName="nit" inputmode="numeric" maxlength="9" placeholder="#########" /></label>
        <label>CUI* <input formControlName="cui" inputmode="numeric" maxlength="13" placeholder="#############" /></label>
        <label>Fecha nacimiento* <input type="date" formControlName="fechaNacimiento" /></label>
        <label>Fecha ingreso* <input type="date" formControlName="fechaIngreso" /></label>

        <!-- 3 -->
        <label>Género*
          <select formControlName="genero">
            <option>Masculino</option><option>Femenino</option><option>Otro</option><option>Prefiero no decir</option>
          </select>
        </label>
        <label>Estado*
          <select formControlName="estado">
            <option>Activo</option><option>Inactivo</option><option>Suspendido</option>
          </select>
        </label>
        <label>Celular* <input formControlName="celular" inputmode="numeric" maxlength="8" placeholder="########" /></label>
        <label>Email* <input type="email" formControlName="email" /></label>

        <!-- 4 -->
        <label class="span-4">Dirección* <input formControlName="direccion" /></label>

        <!-- 5 -->
        <label class="span-2">Rol*
          <select formControlName="rolId">
            <option [ngValue]="null" disabled>Seleccione…</option>
            <option *ngFor="let r of roles" [ngValue]="r.id">{{ r.nombre }}</option>
          </select>
        </label>
        <label *ngIf="isCreate" class="span-2">Contraseña*
          <input type="password" formControlName="password" />
        </label>
        <label *ngIf="!isCreate" class="span-2"></label>

        <!-- 6 -->
        <label class="span-4">Foto <input type="file" (change)="onFile($event)" accept="image/*" /></label>

        <footer class="modal-foot">
          <div class="left">
            <button type="button" class="ghost" (click)="cancel()">Cancelar</button>
            <button *ngIf="isEdit && usuario" type="button" class="danger" (click)="removeInside()">
              <span class="material-icons" aria-hidden="true">delete</span> Eliminar
            </button>
          </div>
          <button type="submit" class="primary">Guardar</button>
        </footer>
      </form>
    </div>
  </section>
</ng-template>
